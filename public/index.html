<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">       

        <link rel="stylesheet" href="//cdn.rawgit.com/fgelinas/timepicker/master/jquery.ui.timepicker.css">
        <script src='//cdn.rawgit.com/fgelinas/timepicker/master/jquery.ui.timepicker.js'></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.js" ></script> 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.2/FileSaver.min.js"  ></script>  
      
        <script src="https://code.iconify.design/2/2.0.3/iconify.min.js"></script>
        <script type="text/javascript" src="js/require.js"></script>

        <script type="text/javascript">
            (function() {
                var config = {
                    baseUrl: 'js'
                };
      
                var dependencies = [
                    'customActivity'
                ];
      
                require(config, dependencies); 
            })();
        </script>
      
        <title>MMS Board</title>
    </head>
    <style>
        html {
            position: relative;
            width: 800px;
            height: 600px;
            height: 100%;
        }
        body {
            background-color:   white;
            border: 3px solid   white;
            color:              #32537c;
            font-family:        'Arial';
            font-size:          13px;
            position:           absolute;
            height:             590px;
            width:              790px;
            padding: 5px 5px 5px 5px;
            border:1px solid black;
        }
        .vc{
            display: flex;
            align-items: center;
        }
        .hr{
            display: flex;
            justify-content: right;
            align-items: center;
        }
        .hl{
            display: flex;
            justify-content: left;
            align-items: center;
        }
        .divC {
                display: flex;
                justify-content: center;
                flex-direction: column;
                align-items: center;
                font-family: 'Arial'; /*'Roboto Mono', monospace;*/
        }
        .divL {
                display: flex;
                justify-content: left;
                flex-direction: column;
                align-items: center;
                font-family: 'Arial'; /*'Roboto Mono', monospace;*/
        }
        .divR {
                display: flex;
                justify-content: right;
                flex-direction: column;
                align-items: center;
                font-family: 'Arial'; /*'Roboto Mono', monospace;*/
        }
        .button {
                background-color: #234c8a; /* Green */
                border: none;
                color: white;
                border-radius: 8px;
                width:48px;
                height:30px;
                padding: 1px 1px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 13px;
                margin: 4px 2px;
                transition-duration: 0.4s;
                cursor: pointer;
        }    
        .button5 {
                background-color: white;
                border-radius: 8px;
                color: #32537C;
                border: 2px solid #32537c;
        }
        .button5:hover {
                background-color: #32537c;
                color: white;
        }        
        .button51 {
                background-color: #32537c;
                border-radius: 8px;
                color: white;
                border: 2px solid #32537c;
        }
        .buttonC {
                background-color: white; 
                border: 1px solid #32537C;
                border-radius: 12px;
                color: #32537C;
                width:20px;
                height:20px;
                padding: 1px 1px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 11px;
                transition-duration: 0.4s;
                cursor: pointer;
        }    
        .buttonC:hover {
                background-color: #32537c;
                color: white;
        }        
        #file { display:none; } 
        #MCEXPL{
            position:absolute;
            top:100px;
            left:200px;
        }
        .expl{
            font-size: 13px;
            width:490px;
            height:290px;
            border:3px solid gray;
            padding:5px;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            background-color:white;            
        }
        .expl_folder{            
        }
        .expl_sub_folders{
            margin-left:20px;
            display:none;
        }
        .expl_folder_name{
            display: flex;
            align-items: center;
            height:25px;            
        }
        .expl_folder_icon{
            font-size:24px;
            color: gray;
            height:25px;
            float:left;
        }
        .expl_files{
            margin-left:20px;
        }
        .expl_file{
            height:20px;
        }
        .expl_file_icon{
            font-size:16px;
            color: #32537c;
            height:20px;
            float:left;
        }
        .expl_file_name{
            display: flex;
            align-items: center;
            height:20px; 
            margin-left:3px;  
            float:left;   
            cursor:pointer;      
        }
</style>
    <body>
        <div style="border: 0px solid white; float: left; width: 790px; height: 50px;">
            <div class="divC" style="float:left;border:0px solid red;height:48px;">
                <img style="float:left;height:48px;" src="./images/amorepacific-logo2.jpg">
            </div>
            <div style="cursor:default;float:left;height:48px;width:320px;margin-left:5px;display:flex; align-items: center; font-size:17px;color:#32537c;"><b>AmorePacific Taiwan Message Service</b></div>
        </div>
        <div style="border: 1px solid white; float: left; width: 270px; height: 530px;margin-top:5px;">
            <img style="float:left; width: 270px; height: 530px;" src="./images/mobile_phone-blue2.png">

            <div id="id_display" style="position:absolute; top:120px; left:25px; border: 1px solid red; width: 232px; height: 393px; overflow:hidden;">
                <div style="width: 230px; height: 393px; overflow-y: scroll;padding-right: 15px;box-sizing: content-box;">
                <!-- Subject Box-->
                    <textarea id="id_display_subject" placeholder="Add your message subject...&#13;&#10;*[MMS] when entering subject"style="font-size: 13px; resize: none;width:222px; height:30px;display:none;overflow:hidden; border: 1px dashed rgb(171, 175, 171);" onkeydown="msgChg(this);" onkeyup="msgChg(this);"></textarea>
                <!-- Body Box-->    
                    <textarea id="id_display_body" placeholder="Add your message body...&#13;&#10;*[LMS] when exceeding 333 chars" style="font-size: 13px; resize: none; width:222px; height:30px;display:none;overflow:hidden;border: 1px dashed rgb(171, 175, 171);"  onkeydown="msgChg(this);" onkeyup="msgChg(this);"></textarea>
                <!-- Content Box-->    
                    <div id="id_display_cts" style="font-size: 13px; width:226px; height:30px;display:none;border: 1px dashed green;" onkeydown="" onkeyup=""></div>
                    <div id="id_display_ctsr" style="display:none;"></div>
                    <div id="id_display_ctsr_width" style="display:none;">0</div>
                    <div id="id_display_ctsr_height" style="display:none;">0</div>
                    <div id="id_display_ctsr_size" style="display:none;">0</div>
                    <div id="id_display_ctsr_srctype" style="display:none;">0</div>
                </div>
            </div>

        </div>
        <div style="border: 3px solid #b4c0ce; float: right; width: 488px; height: 530px;margin-top:5px;background-color:#fafbfc; border-radius:8px;">
                <!-- Right Top -->
                <div id="" style="position:absolute; top: 80px; width:488px;height:130px; border: 0px solid red;" >
                    <div class="vc"  style="width:465px; height:30px; margin-left:20px;cursor:default;">
                        <div class="vc" style="float:left; width:80px; height:25px;"><b>Message ID</b></div>
                        <div class="vc" id="id_msg_id" style="float:left; width:130px; height:25px; padding-left:5px;">MSG-2021-0007</div>
                        <div class="vc" style="float:left; width:80px; height:25px; margin-left:20px;" ><b>Reg. Date</b></div>
                        <div class="vc" style="float:left; width:120px; height:25px; padding-left:5px;">
                            <input type="text" id="id_reg_date" style="width:70px;cursor:pointer;" value="2021.11.25">
                            <input type="text" id="id_reg_time" style="margin-left:5px;width:40px;cursor:pointer;" value="14:00">
                        </div>
                    </div>
                    <div class="vc" style="width:465px; height:50px; margin-left:20px; margin-top:5px;">
                        <div class="vc" style="float:left; width:80px; height:25px; cursor:default;"><b>Description</b></div>
                        <textarea id="id_msg_desc" style="float:left;resize: none;font-size: 13px; width:360px; height:40px; margin-left:5px; border: 1px dashed gray;"></textarea>
                    </div>
                    <div class="vc"  style="width:465px; height:30px; margin-left:20px; margin-top:5px;">
                        <div class="vc" style="float:left; width:80px; height:25px;cursor:default;"><b>Admin. Ofc.</b></div>
                        <div class="vc" style="float:left; width:100px; height:25px; padding-left:5px;">
                            <select name="id_msg_admin" id="id_msg_admin">
                                <option value="" selected hidden>Choose brand</option>
                                <option value="LNG">Laneige</option>
                                <option value="SWS">Sulwhasoo</option>
                            </select>
                        </div>
                        <div class="vc" style="float:left; width:100px; height:25px; margin-left:50px;cursor:default;" >
                            <b>Psn in Charge</b>
                        </div>
                        <div class="vc" style="float:left; width:110px; height:25px; padding-left:5px;">
                            <textarea class="vc" id="id_msg_charge" style="resize: none; padding-top:5px;width:130px;height:18px;border:1px solid gray;"></textarea>
                        </div>
                    </div>
                </div>
                <!-- Right Middle -->
                <div id="" style="position:absolute; top:220px; width:488px;height:200px; border-radius:8px;background-color:#32537c;" >
                    <div class="vc"  style="width:465px; height:30px; margin-left:23px; margin-top:10px;cursor:default;">
                        <div class="vc" style="float:left; width:100px; height:30px; font-size:20px;color:white;" ><b id="id_msg_type" >MMS</b></div>
                    </div>
                    <div class="vc"  style="width:465px; height:90px; margin-left:23px; margin-top:10px; margin-bottom:5px;">
                        <div style="float:left;width:180px; height:80px; margin-left:50px; padding-left:10px;border-left:2px solid white;cursor:default;">
                            <div id="id_title_Total_Size" class="vc" style="width:175px; height:25px; font-size:15px;color:white;" >
                                <p style="width:80px;">Total Size</p>
                                <p class="hr" id="id_size_total" style="width:40px;">373</p>
                                <p class="hr" style="width:50px;font-size:12px;">/ 300KB</p>
                            </div>
                            <div id="id_title_Subject" class="vc" style="width:175px; height:15px; font-size:12px;color:white;" >
                                <p style="width:80px;margin-left:10px;">Subject</p>
                                <p class="hr" id="id_size_subject" style="width:30px;">37</p>
                                <p class="hr" style="width:40px;margin-left:3px;"> Bytes</p>
                            </div>
                            <div id="id_title_Body" class="vc" style="width:175px; height:15px; font-size:12px;color:white;" >
                                <p style="width:80px;margin-left:10px;">Body   </p>
                                <p class="hr"  id="id_size_body" style="width:30px;">170</p>
                                <p class="hr" style="width:40px;margin-left:3px;"> Bytes</p>
                            </div>
                            <div id="id_title_Image" class="vc" style="width:175px; height:15px; font-size:12px;color:white;" >
                                <p style="width:80px;margin-left:10px;">Image  </p>
                                <p class="hr"  id="id_size_content" style="width:30px;">230</p>
                                <p class="hr" style="width:40px;margin-left:3px;"> Bytes</p>
                            </div>
                        </div>                            
                        <div style="float:left;width:180px; height:80px; margin-left:15px; padding-left:10px;border-left:2px solid white;cursor:default;">
                            <div class="vc" style="width:175px; height:25px; font-size:15px;color:white;" >
                                <p style="width:90px;">Total Cost</p>
                                <p class="hr" id="id_cost_total" style="width:40px;">173</p>
                                <p class="hr" style="width:40px;margin-left:3px;font-size:12px;"> TWD</p>
                            </div>
                            <div class="vc" style="width:175px; height:15px; font-size:12px;color:white;" >
                                <p style="width:90px;margin-left:10px;">Unit Price</p>
                                <p class="hr" id="id_cost_unitprice" style="width:30px;">37</p>
                                <p class="hr" style="width:40px;margin-left:3px;">/ unit</p>
                            </div>
                            <div class="vc" style="width:175px; height:15px; font-size:12px;color:white;" >
                                <p style="width:90px;margin-left:10px;">Possible Units</p>
                                <p class="hr" id="id_cost_units" style="width:30px;">170</p>
                                <p class="hr" style="width:40px;margin-left:3px;"> units</p>
                            </div>
                            <div class="vc" style="width:175px; height:15px; font-size:12px;color:white;" >
                                <p style="width:90px;margin-left:10px;">Current Credits</p>
                                <p class="hr" id="id_cost_credit" style="width:30px;">230</p>
                                <p class="hr" style="width:40px;margin-left:3px;"> TWD </p>
                            </div>
                        </div>                            
                    </div>
                    <div class="vc" style="float:left; width:280px; height:25px;  margin-left:23px; margin-top:20px; color:white; font-size:15px;">
                        <div class="vc" style="float:left; width:230px;height:100%">
                            <div style="width:80px;cursor:default;"><b>Send Date</b></div>
                            <input type="text" id="id_send_date" style="width:70px;margin-left:5px;cursor:pointer;" value="2021.11.25">
                            <input type="text" id="id_send_time" style="margin-left:5px;width:40px;cursor:pointer;" value="14:00">
                        </div>
                        <div class="vc" style="float:left; width:230px;height:100%; margin-left:30px;">
                            <input id="id_check_coupon" type="checkbox" style="width:15px; height:15px;cursor:pointer;">
                            <div class="vc" style="margin-left:5px;"><b>Coupon</b></div>
                        </div>
                        <div class="vc" style="float:left; width:230px;height:100%;margin-left:10px;">
                            <input id="id_check_individual" type="checkbox" style="width:15px; height:15px;cursor:pointer;">
                            <div class="vc" style="margin-left:5px;"><b>Individual</b></div>
                        </div>
                    </div>
                </div>

                <!-- Right Bottom -->
                <div id="" style="position:absolute; top:430px; width:488px;height:100px;" >
                    <div style="width:465px; height:50px; margin-left:20px; margin-top:5px;">
                        <div class="vc" style="width:465px; height:25px;cursor:default;">
                            <b>Loaded Content</b><p class="vc" id="id_load_content_type" style="width:300px;margin-left:10px;" >Marketing Cloud Content/ Image: PNG</p>
                        </div>
                        <div class="vc" id="id_load_content_info" style="width:465px; height:30px;">
                            <div class="vc" id="id_load_content" style="width:445px;height:25px;padding-left:3px;border:1px solid gray;cursor:default;">mc://ghoun/images/23471/afgert.png</div>
                            <div class="vc" onclick="" style="float:left; width:25px; height:25px; margin-left:5px;display:none" >
                                <button class="buttonC" id="id_btn_cancel" onclick="" ><b>X</b></button>
                            </div>
                        </div>
                        
                    </div>

                </div>
                <!-- Finalize -->
                <div id="" style="display: flex; justify-content: right; position:absolute; top:540px; width:478px;height: 40px;margin-right:10px;" >
                    <button class="button" id="id_btn_register" onclick="mmsValidation()" style="width:80px"><b>Validate</b></button>
                    <!-- <button class="button" id="id_btn_register" onclick="checkMSGID()" style="width:80px;visibility:hidden"><b>Register</b></button> -->
                </div>
                
            </div>            
        </div>

        <div>
            <button class="button button5" id="id_btn_display_S"  onclick="onClickMCB(this)" style="position:absolute; top:250px; left:260px;"><b>S</b></button>
            <button class="button button5" id="id_btn_display_B"  onclick="onClickMCB(this)" style="position:absolute; top:285px; left:260px;"><b>B</b></button>
            <button class="button button5" id="id_btn_display_MC" onclick="onClickMC(this)" style="position:absolute; top:320px; left:260px;"><b>MC</b></button>
            <button class="button button5" id="id_btn_display_LC" style="position:absolute; top:355px; left:260px;"><b>LC</b></button>
        </div>

        <input id="file-uploader" style="border:1px solid red; display:none;" type="file"  accept="image/*" />

        <div id="MCEXPL" class="expl" style="display:none; width:500px; height:300px;overflow:hidden;" >
            <div style="height:30px;width:500px; display: flex; align-items: center; border-bottom: 1px solid  cornflowerblue;margin-bottom:10px;">
                <div style="width:200px;margin-left:5px;cursor:default;"><b>Marketing Cloud Contents</b></div>
                <span class="iconify" id="mc_cancel" data-icon="feather:x-square" onclick="onClickMC(this)" style="cursor:pointer;font-size:20px;margin-left:280px;color:rgb(114, 139, 139)"></span>
            </div>
            <div id="MCLIST" style="width:505px;height:255px;overflow-y: scroll;padding-right: 13px;box-sizing: content-box;">
            </div>
        </div>

        <div id="expl" class="expl" style="display:none" >
            <div style="height:30px;width:490px; display: flex; align-items: center; border-bottom: 1px solid  cornflowerblue;margin-bottom:10px;">
                <div style="width:200px;margin-left:5px;cursor:default;"><b>Marketing Cloud Contents</b></div>
                <span class="iconify expl_folder_icon" data-icon="feather:x-square" onclick="onClickMC(this)" style="cursor:pointer;font-size:20px;margin-left:260px;color:rgb(114, 139, 139)"></span>                
            </div>
            
            <div id="expl_folder" class="expl_folder">

                <div class="expl_folder_name">
                    <!--<span class="iconify expl_folder_icon" data-icon="mdi:chevron-right"></span>-->
                    <div>
                        <div><i class="iconify" data-icon="mdi:chevron-right" style="display:block"></i></div>
                        <div><i class="iconify" data-icon="mdi:chevron-down"  style="display:none;"></i></div>
                    </div>
                    <div style="cursor:pointer;float:left;" onclick="setClickFolder(this)">folder name</div> 
                    <div style="display:none;">id</div><div style="display:none;">parentId</div>      
                </div>

                <div id="expl_files" class="expl_files"  style="display:none;">
                    <div id="expl_file" class="expl_file" style="" >
                        <div class="vc" style="float:left;height:20px;">
                            <div><i class="iconify fileclose" data-icon="mdi:file" style="display:block; color:#32537C"></i></div>
                            <div><i class="iconify fileopen" data-icon="mdi:file"  style="display:none; color:red;"></i></div>
                        </div>
                        <div class="expl_file_name" style="float:left;height:20px;" onclick="setClickFile(this)">file name 01</div>   
                        <div style="float:left;display:none;">id</div><div style="float:left;display:none;">folderId</div>    
                        <div class="hr" style="cursor:default;float:right;margin-right:10px;height:20px;" >asset type</div> 
                    </div>
                </div>

                <div id="expl_sub_folders" class="expl_sub_folders">
                </div>                
            </div>
        </div>


    </body>


<script type="text/javascript">

// ==============================================================================================================================

//let MSGID;  //global

const tgtImgWidth = 640;
const tgtImgDisplayWidth = 226;
const AWSBUCKETNAME = 'sftptg-prod-us-east-1-d6b3b13e-95fa-413a-a8a3-ff1df49c5b27';
// ==============================================================================================================================

initialization();
//checkMSGID();

$( "#MCEXPL" ).draggable();


// init

function initialization(){

    document.getElementById("id_msg_id").innerHTML = "";
    
    document.getElementById('id_display_subject').value     = "";
    document.getElementById('id_display_body').value        = "";
    document.getElementById('id_display_cts').innerHTML      = "";
    document.getElementById('id_display_ctsr').innerHTML      = "";
    document.getElementById('id_display_ctsr_width').innerHTML      = "";
    document.getElementById('id_display_ctsr_height').innerHTML      = "";
    document.getElementById('id_display_ctsr_size').innerHTML      = "";
    document.getElementById('id_display_ctsr_srctype').innerHTML      = "";

    document.getElementById('id_btn_display_S').classList   = "button";
    document.getElementById('id_btn_display_S').classList.add('button5');
    document.getElementById('id_btn_display_B').classList   = "button";
    document.getElementById('id_btn_display_B').classList.add('button5');
    document.getElementById('id_btn_display_MC').classList   = "button";
    document.getElementById('id_btn_display_MC').classList.add('button5');
    document.getElementById('id_btn_display_LC').classList   = "button";
    document.getElementById('id_btn_display_LC').classList.add('button5');

    document.getElementById('id_size_subject').innerHTML    ="0";
    document.getElementById('id_size_body').innerHTML       ="0";
    document.getElementById('id_size_content').innerHTML    ="0";
    document.getElementById('id_size_total').innerHTML      ="0";

    document.getElementById('id_cost_total').innerHTML      ="0";
    document.getElementById('id_cost_unitprice').innerHTML  ="0";
    document.getElementById('id_cost_units').innerHTML      ="0";
    document.getElementById('id_cost_credit').innerHTML      ="0";

    document.getElementById('id_msg_id').innerHTML           ="";
    document.getElementById('id_msg_desc').value            ="";
    document.getElementById('id_msg_admin').value       ="";
    document.getElementById('id_msg_charge').innerHTML      ="";

    document.getElementById('id_check_coupon').checked        =false;
    document.getElementById('id_check_individual').checked    =false;

    document.getElementById('id_load_content').innerHTML      ="";


    $("#id_send_date").datepicker({ dateFormat: 'yy-mm-dd'  });
    $('#id_send_date').datepicker('setDate', 'today');
    $('#id_send_time').timepicker({ timeFormat: 'p hh:mm'  });

    $("#id_reg_date").datepicker({ dateFormat: 'yy-mm-dd'  });
    $('#id_reg_date').datepicker('setDate', 'today');
    $('#id_reg_time').timepicker({ timeFormat: 'p hh:mm'  });

    //remove focus
    document.getElementById('id_display_subject').blur();
    document.getElementById('id_display_body').blur();
   

    checkMsgType();
}

// check MSGID and load Server Info


function checkMSGID(){
    console.log("checkMSGID START ---------------------------------------------------------------------------");
    console.log("length of msg_id: "+document.getElementById("id_msg_id").innerHTML.length);
    
    var msgid = document.getElementById("id_msg_id");

    if(msgid.innerHTML.length==0){
        let payload = { msgid: "000000" };

        fetch('/message/getmsgid', {
            method: 'POST',
            headers: {
                    'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        }).then(function(response) {
            return response.json();
        }).then(function(data) {
            let vdata = JSON.parse(data);
            console.log(vdata);

            console.log("msg_id: "+vdata.msg_id);
            document.getElementById("id_msg_id").innerHTML=vdata.msg_id;
        });

    }

    console.log("checkMSGID END ---------------------------------------------------------------------------");    
}




// Message Controll Button ------------------------------------------------------------------------------------------------------

function onClickMCB(obj){
    console.log(obj.id);
    console.log("[ onClickMCB ] class list: "+ obj.classList);

    if(obj.classList.contains('button5')){
        console.log(obj.classList);

        obj.classList.remove('button5');
        obj.classList.add('button51');
   
        if(obj.id=="id_btn_display_S"){
            document.getElementById('id_display_subject').style.display="block";  
            document.getElementById('id_display_subject').focus();
        } 
        else if(obj.id=="id_btn_display_B"){
            document.getElementById('id_display_body').style.display="block";
            document.getElementById('id_display_body').focus();
        } 
        else if(obj.id=="id_btn_display_MC" || obj.id=="id_btn_display_LC"){
            //document.getElementById('id_display_cts').innerHTML             = "";
            //document.getElementById('id_display_ctsr').innerHTML            = "";
            //document.getElementById('id_display_ctsr_width').innerHTML      = "";
            //document.getElementById('id_display_ctsr_height').innerHTML     = "";
            //document.getElementById('id_display_ctsr_size').innerHTML       = "";
            //document.getElementById('id_display_ctsr_srctype').innerHTML    = "";

            document.getElementById('id_display_cts').style.display="block";
            document.getElementById('id_display_cts').style.height="30px";
            document.getElementById('id_display_cts').focus();

            if(obj.id=="id_btn_display_MC" && document.getElementById('id_btn_display_LC').classList.contains('button51')){
                document.getElementById('id_btn_display_LC').classList.remove('button51');
                document.getElementById('id_btn_display_LC').classList.add('button5');
            } 
            else if(obj.id=="id_btn_display_LC" && document.getElementById('id_btn_display_MC').classList.contains('button51')){
                document.getElementById('id_btn_display_MC').classList.remove('button51');
                document.getElementById('id_btn_display_MC').classList.add('button5');
            } 
        } 
    }
    else{
        console.log(obj.classList);
        obj.classList.remove('button51');
        obj.classList.add('button5');  

        if(obj.id=="id_btn_display_S"){
            document.getElementById('id_display_subject').style.display="none";
            document.getElementById('id_display_subject').value='';
            document.getElementById('id_display_subject').style.height="30px";
            document.getElementById('id_size_subject').innerHTML="0";
        } 
        else if(obj.id=="id_btn_display_B"){
            document.getElementById('id_display_body').style.display="none";
            document.getElementById('id_display_body').value='';
            document.getElementById('id_display_body').style.height="30px";
            document.getElementById('id_size_body').innerHTML="0";
        } 
        else if(obj.id=="id_btn_display_MC" || obj.id=="id_btn_display_LC" ){
            document.getElementById('id_display_cts').style.display="none";

            document.getElementById('id_size_content').innerHTML        ="0";
            document.getElementById('id_load_content').innerHTML        ="";
            document.getElementById('id_load_content_type').innerHTML   ="";
            document.getElementById('id_display_cts').style.height      ="30px";

            document.getElementById('id_display_cts').innerHTML         = "";
            document.getElementById('id_display_ctsr').innerHTML        = "";
            document.getElementById('id_display_ctsr_width').innerHTML  = "";
            document.getElementById('id_display_ctsr_height').innerHTML = "";
            document.getElementById('id_display_ctsr_size').innerHTML   = "";
            document.getElementById('id_display_ctsr_srctype').innerHTML= "";
        } 
    }

    rearrangeDisplay();
    checkMsgType();
}

// MC Controller ----------------------------------------------------------------------------------------------------------------

function onClickMC(obj){

    if(document.getElementById('id_display_cts').innerHTML.length>0 
        && document.getElementById("MCEXPL").style.display=="none"
            && document.getElementById('id_btn_display_MC').classList.contains('button5') 
                && (document.getElementById("id_display_ctsr_srctype").innerHTML=="MC-I" || document.getElementById("id_display_ctsr_srctype").innerHTML=="MC-B")
            ){
           //alert("onClickMC - 1");
           // just change style of the button
           //let tgt = document.getElementById('id_display_cts').children[0];
           //document.getElementById('id_btn_display_MC').classList.remove('button5');
           //document.getElementById('id_btn_display_MC').classList.add('button51');

           //document.getElementById('id_display_cts').style.display="block";
           //resizeTextArea(document.getElementById("id_display_cts")); 
    }
    else if(document.getElementById("MCEXPL").style.display=="none" && document.getElementById('id_btn_display_MC').classList.contains('button5') ){
        //onClickMCB(obj);
        //alert("onClickMC - 2");

        document.getElementById('MCEXPL').style.display='block';
        document.getElementById('MCLIST').innerHTML='';

        $('body').css("pointer-events","none");
        //$(element).css("pointer-events","auto");
        $(document.getElementById("MCEXPL")).css("pointer-events","auto");

        loadMCContentFolder(obj);

    }
    else{
        //alert("onClickMC - 3");
        //onClickMCB(obj);
        document.getElementById('MCEXPL').style.display='none';
        $('body').css("pointer-events","auto");

    }

    if(obj.id != "mc_cancel"){
        onClickMCB(obj);
    } 
    
    
}


function setClickFolder(obj){

    //console.log(obj.parentNode.children[0].classList);

    if(obj.parentNode.parentNode.children[1].style.display=="block"){

        obj.parentNode.children[0].children[0].children[0].style.display="block";
        obj.parentNode.children[0].children[1].children[0].style.display="none";

        obj.parentNode.parentNode.children[1].style.display="none";
        obj.parentNode.parentNode.children[2].style.display="none";

        console.log("close: "+obj.parentNode.children[0].children[0].children[0].innerHTML);
        console.log("close: "+obj.parentNode.children[0].children[0].children[1].innerHTML);
    } 
    else{
        obj.parentNode.children[0].children[0].children[0].style.display="none";
        obj.parentNode.children[0].children[1].children[0].style.display="block";

        obj.parentNode.parentNode.children[1].style.display="block";
        obj.parentNode.parentNode.children[2].style.display="block";
        console.log(obj.parentNode.innerHTML);

        loadMCContentList(obj);    //forder id
    }
    //obj.parentNode.parentNode.children[1].style.addClass('vc');
}

function setClickFile(obj){

    if(obj.parentNode.children[0].children[0].children[0].style.display=="none"){
/*
        var CX = document.getElementsByClassName("fileopen");
        var CY = document.getElementsByClassName("fileclose");
        
        for(var i = 0; i < CX.length; i++){
            CX[i].style.display="none"; 
            CY[i].style.display="block"; 
        }

        obj.parentNode.children[0].children[0].children[0].style.display="block";
        obj.parentNode.children[0].children[1].children[0].style.display="none";
*/
    }
    else {
        var CX = document.getElementsByClassName("fileopen");
        var CY = document.getElementsByClassName("fileclose");
        
        for(var i = 0; i < CX.length; i++){
            CX[i].style.display="none"; 
            CY[i].style.display="block"; 
        }

        obj.parentNode.children[0].children[0].children[0].style.display="none";
        obj.parentNode.children[0].children[1].children[0].style.display="block";

        loadMCContent(obj);
    }
}

function MC_create_list(data){

    let list = [];    
    var cID = 0;
    var i = 0;

    while(i<list.length+1){
        for(const item of data){
            if(item.parentId==cID){
                list.push([item.id, item.parentId, item.name]);
                console.log("Insert cID "+cID+" ID "+item.id+" Name= "+item.name+" ParentId= "+item.parentId);
            }
        }
        if(i<list.length) cID = list[i][0];
        i++;
    }
    //console.table(list);

    // set list
    let tmp = document.getElementById("expl_folder").cloneNode(true);

    tmp.children[0].children[1].innerHTML=list[0][2]; //folder name
    tmp.children[0].children[2].innerHTML=list[0][0];  //ID
    tmp.children[0].children[3].innerHTML=list[0][1];  //PID
    tmp.id="MC_"+list[0][0];
    tmp.children[1].removeChild(tmp.children[1].children[0]);

    document.getElementById("MCLIST").appendChild(tmp);
    document.getElementById("MCEXPL").style.display="block";

    i=1;
    while(i<list.length){

        var PID = list[i][1];
        var checkPool = []; //id, pid
        checkPool.push(["MC_"+list[0][0]]); //init

        //console.log("=========================================================================================");
        //console.log("Current List: "+i+" ["+list[i][0]+","+list[i][1]+"] checkPool.length: "+checkPool.length);
        //console.table(checkPool);

        let k=0;
        while(k<checkPool.length){
            let tgtPool = document.getElementById(checkPool[k]);
            //console.log("----------- Processing k: "+k+ " Search ["+list[i][0]+","+list[i][1]+"]" );
            //console.table(checkPool);
            let cPID = tgtPool.children[0].children[2].innerHTML;    //foldername->ID

            if(PID==cPID){  // add to child
                var tmp2 = document.getElementById("expl_folder").cloneNode(true);
                tmp2.children[0].children[1].innerHTML=list[i][2]; //folder name
                tmp2.children[0].children[2].innerHTML=list[i][0];  //ID
                tmp2.children[0].children[3].innerHTML=list[i][1];  //PID
                tmp2.children[1].removeChild(tmp2.children[1].children[0]);
                tmp2.id="MC_"+list[i][0];

                tgtPool.children[2].appendChild(tmp2);
                k=1000;
                //console.log("Inserted: "+tmp2.id);
            }
            else{   // add child to checkPool
                if(tgtPool.children[2].childElementCount>0){
                    for (let j = 0; j < tgtPool.children[2].childElementCount; j++) {
                        checkPool.push([tgtPool.children[2].children[j].id]);
                    }                    
                }    
            }
            k++;
        }
        i++;
    }
    

}

function loadMCContentFolder(obj) {
      
    listhtml = '';

    //01. Request List
    let payload = { ctsid: "000000" };

    fetch('/contents/list', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    }).then(function(response) {
        return response.json();
    }).then(function(data) {
        
        //02. Arranging
        N = Object.keys(data).length;
        //console.log("Length od Data = "+N);

        for(const item of data){
            //console.log("ID= "+item.id+" Name= "+item.name+" ParentId= "+item.parentId);
        }

        MC_create_list(data);

    });
}

function loadMCContentList(obj) {
    
    folderId = obj.parentNode.children[2].innerHTML;
    //console.log("folderId: "+folderId);


    let payload = { catid: folderId };
    //console.log("payload  "+JSON.stringify(payload));

    fetch('/contents/items', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
    }).then(function(response) {
        //console.log("Result: >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> "+ response.status );
        //console.log(response.body);
        if(response.status ==200) return response.json();
        else return 999;
    }).then(function(data) {

      if(data != 999 && data.length>0){
          console.log(data);
          //obj.parentNode.parentNode.children[1].removeChild(obj.parentNode.parentNode.children[1].children[0]);

          //console.log(obj.parentNode.parentNode.childern[0].innerHTML);
          //obj.parentNode.parentNode.children[1].innerHTML="";

          for(const item of data){

            var tmp = document.getElementById("expl_file").cloneNode(true);
                tmp.children[1].innerHTML=item.name; //file name
                tmp.children[2].innerHTML=item.id;  //ID
                tmp.children[3].innerHTML=item.category.id;  //folder ID
                tmp.children[4].innerHTML=item.assetType.name;  //folder ID
                tmp.id="MC_FILE_"+item.id;

                obj.parentNode.parentNode.children[1].appendChild(tmp);

                //console.log("ID= "+item.id+" Name= "+item.name+" assetType= "+item.assetType.name+" category= "+item.category.id );
          } 
      }
      else{
        console.log(data);
      }
    });
}


function loadMCContent(obj){  

    const AWSBUCKETNAME = 'sftptg-prod-us-east-1-d6b3b13e-95fa-413a-a8a3-ff1df49c5b27';

    var inctsid = obj.parentNode.children[2].innerHTML;
//console.log("inctsid: "+inctsid);

    let payload = { ctsid: inctsid };
    var fileExt='';
    var fileGroup='';

    fetch('/contents/load', {
        method: 'POST',
        headers: {
        'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
    }).then(function(response) {
        //console.log("Result: "+ response.status )
        if(response.status ==200) return response.json();
        else return 999;
    }).then(function(data) {

        if(data != 999){

            var turl = data.fileProperties.publishedURL;
            var size = data.fileProperties.fileSize;    // raw file size
            fileExt  = data.fileProperties.extension;
            fileType = data.assetType.displayName;
            let rawfilename =data.fileProperties.fileName;

            if(data.assetType.name=='htmlblock'){

               document.body.style.cursor ='wait';

                document.getElementById('id_display_cts').innerHTML='<div></div>';
                const img = document.createElement('img');
                document.getElementById("id_display_cts").children[0].appendChild(img);
                img.style.display="none";
                //img.src = turl;

                document.getElementById("id_display_ctsr").innerHTML='<div id="IDX-SUB" style="display: table-row;"></div>';
                // 'display: table-row' is required to gen a fitted image with puppeteer
                const cb = document.createElement('div');
                document.getElementById("id_display_ctsr").children[0].appendChild(cb);
                cb.innerHTML = data.content;
                console.log("MC cb innerHTML = "+cb.innerHTML);

                document.getElementById("id_display_ctsr_srctype").innerHTML='MC-B';
                document.getElementById('id_load_content').innerHTML=rawfilename;
                document.getElementById('id_load_content_type').innerHTML=fileType;           

                (async () => {
                    let svrImgInfo = await resetCTS2("MC-B");

                    img.src = "https://"+AWSBUCKETNAME+".s3.amazonaws.com/"+svrImgInfo.filename;    // s3://public/pathfilename

                    console.log("svrImgInfo: "+svrImgInfo);

                    img.onload= function(){

                        var ratio = img.height / img.width;
                        img.style.border="1px solid red";

                        if( img.width  > tgtImgDisplayWidth){ 
                            img.width  = tgtImgDisplayWidth;
                        }
                        img.height = parseInt(img.width * ratio);

                        img.style.display="block";
                        document.getElementById("id_display_cts").style.height=img.height+"px";

                        document.body.style.cursor ='default';
                    };
                    //04. change message type status
                    checkMsgType();
                })();   //async
            }   //if
            else if(data.assetType.name=='jpg' || data.assetType.name=='png' ||data.assetType.name=='jpeg'){

                document.body.style.cursor ='wait';

                document.getElementById('id_display_cts').innerHTML='<div></div>';
                const img = document.createElement('img');
                document.getElementById("id_display_cts").children[0].appendChild(img);
                img.style.display="none";
                //img.src = turl;

                document.getElementById("id_display_ctsr").innerHTML='<div id="IDX-SUB" style="display: table-row;"></div>';
                // 'display: table-row' is required to gen a fitted image with puppeteer
                const imgr = document.createElement('img');
                document.getElementById("id_display_ctsr").children[0].appendChild(imgr);
                imgr.src = turl;
                //console.log("MC img src = "+turl);

                document.getElementById("id_display_ctsr_srctype").innerHTML='MC-I';
                document.getElementById('id_load_content').innerHTML=rawfilename;
                document.getElementById('id_load_content_type').innerHTML=fileType;

                (async () => {
                    let svrImgInfo = await resetCTS2("MC-I");

                    img.src = "https://"+AWSBUCKETNAME+".s3.amazonaws.com/"+svrImgInfo.filename;    // s3://public/pathfilename

                    console.log("svrImgInfo: "+svrImgInfo);

                    img.onload= function(){

                        var ratio = img.height / img.width;
                        //img.style.border="1px solid red";

                        if( img.width  > tgtImgDisplayWidth){ 
                            img.width  = tgtImgDisplayWidth;
                        }
                        img.height = parseInt(img.width * ratio);

                        img.style.display="block";
                        document.getElementById("id_display_cts").style.height=img.height+"px";

                        document.body.style.cursor ='default';
                    };
                    //04. change message type status
                    checkMsgType();
                })();   //async
            }   // else if
        }
        else{
            console.log(data);
        }
    });
 // setFile(hctsid,fileExt,fileGroup);
}

    
function resetCTS2(tgtname){

return new Promise((resolve, reject) => {
        
        (async () => {
            document.getElementById("id_display_ctsr_srctype").innerHTML=tgtname;

            let obj  = document.getElementById("id_display_cts");
            let objr = document.getElementById("id_display_ctsr");

            // upload to server to gen image and get file info
            //let tgtfilename = document.getElementById('id_load_content').innerHTML;
            //if(tgtname=="MC-B") tgtfilename = tgtfilename + ".jpg";
            let msg_id = document.getElementById("id_msg_id").innerHTML;

            let payload = { 
                msg_id:     document.getElementById("id_msg_id").innerHTML, // if none, reject
                path:       'public/APPS/MMSTW/'+msg_id+'/pup',
                filename:   document.getElementById('id_load_content').innerHTML,
                cts:        objr.innerHTML
            };

            console.log("[ resetCTS2 ] "+payload);

            fetch('/contents/getUploadContentInfo', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            }).then(function(response) {
                return response.json();    
            }).then(function(data) {

                console.log(data);
                document.getElementById("id_display_ctsr_size").innerHTML=data.size;
                document.getElementById("id_display_ctsr_width").innerHTML=data.width;
                document.getElementById("id_display_ctsr_height").innerHTML=data.height;
                document.getElementById("id_size_content").innerHTML=data.size; 

                resolve(data);            

            });
        })();
    });
}





// LC Controller ----------------------------------------------------------------------------------------------------------------

const localFileUploader = document.getElementById('file-uploader');
const reader = new FileReader();


$(function () {
    $('#id_btn_display_LC').click(function (e) {
        e.preventDefault();
        onClickMCB(document.getElementById('id_btn_display_LC'));

        if(document.getElementById('id_btn_display_LC').classList.contains('button51')){
            //document.body.onfocus = checkIt;
            
            $('#file-uploader').click();    // call localFileUploader
        }
    });
});


function checkIt()
{
    console.log("onfocused "+document.getElementById('file-uploader').value.length);
    if(!document.getElementById('file-uploader').value.length) {
        alert('Canceled');
        document.body.onfocus = null;
        onClickMCB(document.getElementById('id_btn_display_LC'));
        //return true;
    }
    //return false;
}	



localFileUploader.addEventListener('change', (event) => {
    
    console.log("LC Procesing =====================================================================");

    const files = event.target.files;
    const file = files[0];

    if(file){
        
        let msg_id = document.getElementById("id_msg_id").innerHTML;

        reader.readAsDataURL(file);
  
        reader.addEventListener('load', (event) => {

            //reader.removeEventListener("load", (event));
            document.body.style.cursor ='wait';

            document.getElementById('id_display_cts').innerHTML='<div></div>';
            const img = document.createElement('img');
            document.getElementById("id_display_cts").children[0].appendChild(img);
            img.style.display="none";
            //img.src = event.target.result;  //image blob

            document.getElementById("id_display_ctsr").innerHTML='<div id="IDX-SUB" style="display: table-row;"></div>';
            // 'display: table-row' is required to gen a fitted image with puppeteer
            const imgr = document.createElement('img');
            document.getElementById("id_display_ctsr").children[0].appendChild(imgr);
            //imgr.src = event.target.result;

            document.getElementById("id_display_ctsr_srctype").innerHTML='LC-I';
            document.getElementById('id_load_content').innerHTML=file.name;
            document.getElementById('id_load_content_type').innerHTML=file.type;


            // 02. upload the image to s3/public/{msg_id}/{fname}
                let path  = "public/APPS/MMSTW/raw";

                let fname = msg_id+"_"+file.name;
                const formData = new FormData()
                formData.append('myFile', file);
                formData.set('myFile', file, fname );                


                fetch('/contents/uploadImage', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {

                    console.log("uploadImage data: "+JSON.stringify(data));
                    
                    //img.src="https://"+AWSBUCKETNAME+".s3.amazonaws.com/public/APPS/MMSTW/"+msg_id+"/"+fname;
                    console.log("RAW: https://"+AWSBUCKETNAME+".s3.amazonaws.com/"+path+"/"+fname);
                    
                    imgr.src="https://"+AWSBUCKETNAME+".s3.amazonaws.com/"+path+"/"+fname; 
                    

                    imgr.onload = function(){

                        var ratio = imgr.height / imgr.width;
                        console.log("ratio= "+ratio);

                        // 01. show the image
                        if( imgr.width  > tgtImgDisplayWidth){ 
                            img.width  = tgtImgDisplayWidth;
                            img.height = parseInt(img.width * ratio);
                        }

                        document.getElementById("id_display_cts").style.height=img.height+"px";
                        //img.style.display="block";
                        img.alt = file.name;

                        console.log("event: imgr.onload <>");

                        //03. Get File Info: size, width, height after tuning in server
                        (async () => {
                            let svrImgInfo = await resetCTS2("LC-I");
                            
                            img.src = "https://"+AWSBUCKETNAME+".s3.amazonaws.com/"+svrImgInfo.filename;    // s3://public/pathfilename
                            console.log("PUP: "+img.src);
                            img.style.display="block";

                            document.body.style.cursor ='default';
                            //04. change message type status
                            checkMsgType();
                        })();
                        
                    }// imgr.onload

                })
                .catch(error => {
                    console.log(error);
                    console.error(error);
                })
            
        },{ once: true }); //reader. important
    }// if file
    else{
        //console.log("Response");
        //onClickMCB(document.getElementById('id_btn_display_LC'));
    }

});  //,{ once: true }





function rearrangeDisplay(){
// for rearrange of display

    if(document.getElementById('id_btn_display_S').classList.contains('button51')){
        document.getElementById('id_display_body').style.marginTop="10px"; //display   
        document.getElementById('id_display_cts').style.marginTop="10px"; //display   
    }
    else{
        if(document.getElementById('id_btn_display_B').classList.contains('button51')){
            document.getElementById('id_display_body').style.marginTop="0px"; //
            document.getElementById('id_display_cts').style.marginTop="10px"; //        
        }
        else{
            document.getElementById('id_display_body').style.marginTop="0px"; //
            document.getElementById('id_display_cts').style.marginTop="0px"; //
        }
    }

    if(document.getElementById('id_btn_display_B').classList.contains('button51')){
        document.getElementById('id_display_cts').style.marginTop="10px"; //display   
    }
    else{
        if(document.getElementById('id_btn_display_S').classList.contains('button51')){
            document.getElementById('id_display_cts').style.marginTop="10px"; //
        }
        else{
            document.getElementById('id_display_cts').style.marginTop="0px"; //
        }

    }

    //checkMsgType();
}


// Message Change Manager

function msgChg(obj){

    let msgType = document.getElementById("id_msg_type").innerHTML;


    if(obj.id=="id_display_subject"){  

        const maxSubjectChars = 95; //common max
        let size = 0;

        if( msgType=='MMS') size = getBytes('id_display_subject');
        else size = document.getElementById('id_display_subject').value.length;

        console.log("size: "+getBytes('id_display_subject')+" lengh: "+document.getElementById('id_display_subject').value.length);

        document.getElementById("id_size_subject").innerText = size;
        
        if(size>maxSubjectChars){
            obj.value = obj.value.substring(0,maxSubjectChars);
        }
        else{
            obj.style.height = "1px";
            obj.style.height = (12+obj.scrollHeight)+"px";
        }
    }
    else if(obj.id=="id_display_body"){        

        const maxBodyChars = 4000; //common max
        let size = 0;

        if( msgType=='MMS') size = getBytes('id_display_body');
        else size = document.getElementById('id_display_body').value.length;

        document.getElementById("id_size_body").innerText = size;

        if(size>maxBodyChars){
            obj.value = obj.value.substring(0,maxBodyChars);
        }
        else{
            obj.style.height = "1px";
            obj.style.height = (12+obj.scrollHeight)+"px";
        }
    }

    checkMsgType();
    
}


function checkMsgType(){

    if( document.getElementById('id_btn_display_S').classList.contains('button51')  ||
        document.getElementById('id_btn_display_MC').classList.contains('button51') ||
        document.getElementById('id_btn_display_LC').classList.contains('button51') )
    {   //MMS
        document.getElementById('id_msg_type').innerHTML="MMS";
        document.getElementById('id_title_Body').children[2].innerHTML="Bytes";

        document.getElementById('id_title_Subject').children[0].style.color="#FFFFFF";
        document.getElementById('id_title_Body').children[0].style.color="#FFFFFF";
        document.getElementById('id_title_Image').children[0].style.color="#FFFFFF";

        document.getElementById('id_title_Subject').children[2].style.color="#FFFFFF";
        document.getElementById('id_title_Body').children[2].style.color="#FFFFFF";
        document.getElementById('id_title_Image').children[2].style.color="#FFFFFF";

    } else if( document.getElementById('id_display_body').value.length < 333 ){   // SMS
        document.getElementById('id_msg_type').innerHTML="SMS";
        document.getElementById('id_title_Body').children[2].innerHTML="Chars";

        // keep body
        document.getElementById('id_title_Subject').children[0].style.color="gray";
        document.getElementById('id_title_Body').children[0].style.color="#FFFFFF";
        document.getElementById('id_title_Image').children[0].style.color="gray";

        document.getElementById('id_title_Subject').children[2].style.color="gray";
        document.getElementById('id_title_Body').children[2].style.color="#FFFFFF";
        document.getElementById('id_title_Image').children[2].style.color="gray";
        
    } else{ // LMS
        document.getElementById('id_msg_type').innerHTML="LMS";
        document.getElementById('id_title_Body').children[2].innerHTML="Chars";

        // keep body
        document.getElementById('id_title_Subject').children[0].style.color="gray";
        document.getElementById('id_title_Body').children[0].style.color="#FFFFFF";
        document.getElementById('id_title_Image').children[0].style.color="gray";

        document.getElementById('id_title_Subject').children[2].style.color="gray";
        document.getElementById('id_title_Body').children[2].style.color="#FFFFFF";
        document.getElementById('id_title_Image').children[2].style.color="gray";

    }

    //if(document.getElementById('id_msg_type').innerHTML=="SMS" && strLen("id_display_body")>333){
    //    document.getElementById('id_msg_type').innerHTML="LMS";
   // }

   chkMsgChg();
   calcSizeCost();
}


function chkMsgChg(){

    let msgType = document.getElementById("id_msg_type").innerHTML;

    if( msgType=='MMS') size = getBytes('id_display_subject');
    else size = document.getElementById('id_display_subject').value.length;

    document.getElementById("id_size_subject").innerText = size;


    if( msgType=='MMS') size = getBytes('id_display_body');
    else size = document.getElementById('id_display_body').value.length;

    document.getElementById("id_size_body").innerText = size;

}


function strLen(str) {
    var count = 0;
    for (var i = 0, len = str.length; i < len; i++) {
        count += str.charCodeAt(i) < 256 ? 1 : 2;
    }
    return count;
}


// Subs

function calcSizeCost(){

    //size
    var size = parseInt(document.getElementById('id_size_subject').innerHTML)
             + parseInt(document.getElementById('id_size_body').innerHTML)
             + parseInt(document.getElementById('id_size_content').innerHTML);

    document.getElementById('id_size_total').innerHTML= size;

    //cost
    document.getElementById('id_cost_credit').innerHTML=2000;

    let CR = document.getElementById('id_cost_credit').innerHTML;

    CR = 2000;
    document.getElementById('id_cost_unitprice').innerHTML=getPrice(size);
    //set calc rule
    console.log("price= "+document.getElementById('id_cost_unitprice').innerHTML);

    let psbl = 0;
    
    if(parseFloat(document.getElementById('id_cost_unitprice').innerHTML)>0.0){
        psbl = parseInt( CR / parseFloat(document.getElementById('id_cost_unitprice').innerHTML) );
    }

    document.getElementById('id_cost_units').innerHTML=psbl;

    var cost = psbl * parseFloat(document.getElementById('id_cost_unitprice').innerHTML);

    document.getElementById('id_cost_total').innerHTML= cost;
}


function getPrice(size){

    let price = 0;

    if(document.getElementById('id_msg_type').innerHTML=='MMS'){
        if(size >      0) price = 3;
        if(size >  50000) price = 5;
        if(size > 300000) price = -1;
    }
    else{
        if(size >   0)  price = 1;
        if(size >  70)  price = 2;
        if(size > 134)  price = 3;
        if(size > 201)  price = 4;
        if(size > 268)  price = 5;
        if(size > 333)  price = 5;
        if(size >4000)  price = -1;
    }

    return price;
}


function getBytes(tid){
    
    let totalByte=0;

    if(tid=="id_display_subject" || tid=="id_display_body" ){
        const text_val = document.getElementById(tid).value; //input message
        const text_len = text_val.length; //n of characters
        
        for(let i=0; i<text_len; i++){
            const each_char = text_val.charAt(i);
            const uni_char = escape(each_char) //  
            if(uni_char.length>4){
                //  : 2Byte
                totalByte += 2;
            }else{
                // ,, : 1Byte
                totalByte += 1;
            }
        }
    }
    else if(tid=="id_display_cts"){
        totalByte=parseInt(document.getElementById(tid).innerHTML);
    }

  return totalByte;
}

function resizeTextArea(obj) {
  obj.style.height = "1px";
  obj.style.height = (12+obj.scrollHeight)+"px";
}

function mmsValidation(){
    let subject_size = document.getElementById("id_size_subject").innerHTML;
    let body_size = document.getElementById("id_size_body").innerHTML;
    let content_size = document.getElementById("id_size_content").innerHTML;

    if(subject_size == 0 && body_size == 0 & content_size == 0){
        alert("[Validation Error] Please fill out the message template");
    } else if(subject_size > 0 && content_size == 0){
        alert("[Validation Error] Please add content when sending MMS");
    }
    alert("Validated! Click done to proceed");

}

//

</script>    
</html>